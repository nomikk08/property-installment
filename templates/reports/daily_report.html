{% extends "base.html" %}
{% block content %}
<div class="max-w-7xl mx-auto py-10 px-6">
  <h1 class="text-2xl font-bold mb-6">📅 Daily Income & Expenses Report</h1>

  <!-- Date Filter -->
  <form method="get" class="flex items-center gap-3 mb-6">
    <input
        type="date"
        name="date"
        value="{{ selected_date|date:'Y-m-d' }}"
        class="border border-gray-300 rounded px-3 py-2 focus:ring-2 focus:ring-blue-400"
    >
    <button type="submit" class="bg-blue-600 text-white px-4 py-2 rounded">Filter</button>
    <a href="{% url 'download_daily_report_pdf' %}?date={{ selected_date|date:'Y-m-d' }}"
        class="bg-gray-800 text-white px-4 py-2 rounded hover:bg-gray-900">
        📄 Download PDF
    </a>
  </form>

  <div class="grid md:grid-cols-2 gap-8">
    <!-- Expenses -->
    <div class="bg-white shadow rounded p-6 border">
      <h2 class="text-xl font-semibold mb-4 text-red-600">💸 Daily Expenses</h2>
      {% if daily_expenses %}
        <table class="min-w-full border text-sm">
          <thead class="bg-gray-100">
            <tr>
              <th class="py-2 px-3 text-left">Title</th>
              <th class="py-2 px-3 text-left">Category</th>
              <th class="py-2 px-3 text-right">Amount</th>
            </tr>
          </thead>
          <tbody>
            {% for exp in daily_expenses %}
            <tr class="border-b hover:bg-gray-50">
              <td class="py-2 px-3">{{ exp.title }}</td>
              <td class="py-2 px-3">{{ exp.category.name }}</td>
              <td class="py-2 px-3 text-right text-red-600">Rs {{ exp.amount }}</td>
            </tr>
            {% endfor %}
          </tbody>
        </table>
      {% else %}
        <p class="text-gray-500">No expenses recorded.</p>
      {% endif %}
      <div class="mt-4 font-semibold text-right">
        Total: <span class="text-red-600">Rs {{ total_expenses }}</span>
      </div>
    </div>

    <!-- Income -->
    <div class="bg-white shadow rounded p-6 border">
      <h2 class="text-xl font-semibold mb-4 text-green-600">💰 Daily Income</h2>

      <h3 class="text-lg font-medium mb-2">🏠 Bookings</h3>
      {% if daily_bookings %}
        <ul class="mb-4 list-disc list-inside text-sm">
          {% for b in daily_bookings %}
            <li>{{ b.buyer.name }} — Rs {{ b.down_payment_amount }}</li>
          {% endfor %}
        </ul>
      {% else %}
        <p class="text-gray-500 mb-4">No bookings today.</p>
      {% endif %}

      <h3 class="text-lg font-medium mb-2">📄 Installments</h3>
      {% if daily_installments %}
        <ul class="list-disc list-inside text-sm">
          {% for p in daily_installments %}
            <li>{{ p.booking.buyer.name }} — Rs {{ p.amount }}</li>
          {% endfor %}
        </ul>
      {% else %}
        <p class="text-gray-500">No installments paid today.</p>
      {% endif %}

      <div class="mt-4 font-semibold text-right">
        Total: <span class="text-green-600">Rs {{ total_income }}</span>
      </div>
    </div>
  </div>

  <!-- Net Summary -->
  <div class="mt-8 bg-gray-50 p-4 rounded border text-center">
    <h3 class="text-xl font-bold">📊 Net Profit/Loss</h3>
    <p class="text-lg mt-2">
      Income: <span class="text-green-600 font-semibold">Rs {{ total_income }}</span> —
      Expenses: <span class="text-red-600 font-semibold">Rs {{ total_expenses }}</span>
    </p>
    <p class="mt-2 text-2xl font-bold {% if net_profit >= 0 %}text-green-700{% else %}text-red-700{% endif %}">
      Net: Rs {{ net_profit }}
    </p>
  </div>
</div>
{% endblock %}
